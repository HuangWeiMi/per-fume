var EmulatedPerformance=function(){function t(){}return t.prototype.now=function(){return Date.now()/1e3},t.prototype.mark=function(t,e){},t.prototype.measure=function(t,e){return this.getDurationByMetric(t,e)},t.prototype.firstContentfulPaint=function(t){var e=this;setTimeout(function(){t(e.getFirstPaint())})},t.prototype.getDurationByMetric=function(t,e){return e[t].end-e[t].start||0},t.prototype.getFirstPaint=function(){var t=window.performance.timing,e={duration:0,entryType:"paint",name:"first-contentful-paint",startTime:0};return t&&0!==t.navigationStart&&(e.startTime=Date.now()-t.navigationStart),e},t}(),commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var ttiPolyfill=createCommonjsModule(function(t){!function(){var e="undefined"!=typeof window&&window===this?this:void 0!==commonjsGlobal&&null!=commonjsGlobal?commonjsGlobal:this,n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)};function i(){i=function(){},e.Symbol||(e.Symbol=o)}var r=0;function o(t){return"jscomp_symbol_"+(t||"")+r++}function a(){i();var t=e.Symbol.iterator;t||(t=e.Symbol.iterator=e.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&n(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return s(this)}}),a=function(){}}function s(t){var n=0;return function(t){return a(),(t={next:t})[e.Symbol.iterator]=function(){return this},t}(function(){return n<t.length?{done:!1,value:t[n++]}:{done:!0}})}function c(t){a();var e=t[Symbol.iterator];return e?e.call(t):s(t)}function f(t){if(!(t instanceof Array)){t=c(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}var u=0;var l="img script iframe link audio video source".split(" ");function m(t,e){for(var n=(t=c(t)).next();!n.done;n=t.next())if(n=n.value,e.includes(n.nodeName.toLowerCase())||m(n.children,e))return!0;return!1}function p(t,e){if(2<t.length)return performance.now();for(var n=[],i=(e=c(e)).next();!i.done;i=e.next())i=i.value,n.push({timestamp:i.start,type:"requestStart"}),n.push({timestamp:i.end,type:"requestEnd"});for(i=(e=c(t)).next();!i.done;i=e.next())n.push({timestamp:i.value,type:"requestStart"});for(n.sort(function(t,e){return t.timestamp-e.timestamp}),t=t.length,e=n.length-1;0<=e;e--)switch(i=n[e],i.type){case"requestStart":t--;break;case"requestEnd":if(2<++t)return i.timestamp;break;default:throw Error("Internal Error: This should never happen")}return 0}function h(t){t=t||{},this.w=!!t.useMutationObserver,this.u=t.minValue||null,t=window.__tti&&window.__tti.e;var e=window.__tti&&window.__tti.o;this.a=t?t.map(function(t){return{start:t.startTime,end:t.startTime+t.duration}}):[],e&&e.disconnect(),this.b=[],this.f=new Map,this.j=null,this.v=-1/0,this.i=!1,this.h=this.c=this.s=null,function(t,e){var n=XMLHttpRequest.prototype.send,i=u++;XMLHttpRequest.prototype.send=function(r){for(var o=[],a=0;a<arguments.length;++a)o[a-0]=arguments[a];var s=this;return t(i),this.addEventListener("readystatechange",function(){4===s.readyState&&e(i)}),n.apply(this,o)}}(this.m.bind(this),this.l.bind(this)),function(t,e){var n=fetch;fetch=function(i){for(var r=[],o=0;o<arguments.length;++o)r[o-0]=arguments[o];return new Promise(function(i,o){var a=u++;t(a),n.apply(null,[].concat(f(r))).then(function(t){e(a),i(t)},function(t){e(t),o(t)})})}}(this.m.bind(this),this.l.bind(this)),function(t){t.c=new PerformanceObserver(function(e){for(var n=(e=c(e.getEntries())).next();!n.done;n=e.next())if("resource"===(n=n.value).entryType&&(t.b.push({start:n.fetchStart,end:n.responseEnd}),g(t,p(t.g,t.b)+5e3)),"longtask"===n.entryType){var i=n.startTime+n.duration;t.a.push({start:n.startTime,end:i}),g(t,i+5e3)}}),t.c.observe({entryTypes:["longtask","resource"]})}(this),this.w&&(this.h=function(t){var e=new MutationObserver(function(e){for(var n=(e=c(e)).next();!n.done;n=e.next())"childList"==(n=n.value).type&&m(n.addedNodes,l)?t(n):"attributes"==n.type&&l.includes(n.target.tagName.toLowerCase())&&t(n)});return e.observe(document,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["href","src"]}),e}(this.B.bind(this)))}function d(t){t.i=!0;var e=0<t.a.length?t.a[t.a.length-1].end:0,n=p(t.g,t.b);g(t,Math.max(n+5e3,e))}function g(t,e){!t.i||t.v>e||(clearTimeout(t.j),t.j=setTimeout(function(){var e=performance.timing.navigationStart,n=p(t.g,t.b);e=(window.a&&window.a.A?1e3*window.a.A().C-e:0)||performance.timing.domContentLoadedEventEnd-e;if(t.u)var i=t.u;else performance.timing.domContentLoadedEventEnd?i=(i=performance.timing).domContentLoadedEventEnd-i.navigationStart:i=null;var r=performance.now();null===i&&g(t,Math.max(n+5e3,r+1e3));var o=t.a;5e3>r-n?n=null:n=5e3>r-(n=o.length?o[o.length-1].end:e)?null:Math.max(n,i),n&&(t.s(n),clearTimeout(t.j),t.i=!1,t.c&&t.c.disconnect(),t.h&&t.h.disconnect()),g(t,performance.now()+1e3)},e-performance.now()),t.v=e)}h.prototype.getFirstConsistentlyInteractive=function(){var t=this;return new Promise(function(e){t.s=e,"complete"==document.readyState?d(t):window.addEventListener("load",function(){d(t)})})},h.prototype.m=function(t){this.f.set(t,performance.now())},h.prototype.l=function(t){this.f.delete(t)},h.prototype.B=function(){g(this,performance.now()+5e3)},e.Object.defineProperties(h.prototype,{g:{configurable:!0,enumerable:!0,get:function(){return[].concat(f(this.f.values()))}}});var v={getFirstConsistentlyInteractive:function(t){return t=t||{},"PerformanceLongTaskTiming"in window?new h(t).getFirstConsistentlyInteractive():Promise.resolve(null)}};t.exports?t.exports=v:window.ttiPolyfill=v}()}),Performance=function(){function t(){this.timeToInteractiveDuration=0,this.ttiPolyfill=ttiPolyfill}return t.supported=function(){return window.performance&&!!performance.now&&!!performance.mark},t.supportedPerformanceObserver=function(){return window.chrome},t.supportedLongTask=function(){return"PerformanceLongTaskTiming"in window},t.prototype.now=function(){return window.performance.now()},t.prototype.mark=function(t,e){var n="mark_"+t+"_"+e;window.performance.mark(n)},t.prototype.measure=function(t,e){var n="mark_"+t+"_start",i="mark_"+t+"_end";return window.performance.measure(t,n,i),this.getDurationByMetric(t,e)},t.prototype.firstContentfulPaint=function(t){this.perfObserver=new PerformanceObserver(this.performanceObserverCb.bind(this,t)),this.perfObserver.observe({entryTypes:["paint"]})},t.prototype.getDurationByMetric=function(t,e){var n=this.getMeasurementForGivenName(t);return n&&"measure"===n.entryType?n.duration:-1},t.prototype.getMeasurementForGivenName=function(t){var e=window.performance.getEntriesByName(t);return e[e.length-1]},t.prototype.performanceObserverCb=function(t,e){var n=e.getEntries().filter(function(t){return"first-contentful-paint"===t.name});n.length&&(t(n[0]),this.perfObserver.disconnect())},t.prototype.timeToInteractive=function(t,e){this.ttiPolyfill.getFirstConsistentlyInteractive({minValue:t}).then(e)},t}(),Perfume=function(){function t(t){void 0===t&&(t={}),this.config={firstContentfulPaint:!1,googleAnalytics:{enable:!1,timingVar:"name"},logPrefix:"⚡️ Perfume.js:",logging:!0,timeToInteractive:!1},this.firstContentfulPaintDuration=0,this.timeToInteractiveDuration=0,this.metrics={},this.config=Object.assign({},this.config,t),this.perf=Performance.supported()?new Performance:new EmulatedPerformance,this.perf.config=this.config,Performance.supportedPerformanceObserver()?this.perf.firstContentfulPaint(this.firstContentfulPaintCb.bind(this)):(this.perfEmulated=new EmulatedPerformance,this.perfEmulated.firstContentfulPaint(this.firstContentfulPaintCb.bind(this)))}return t.prototype.start=function(t){this.checkMetricName(t)&&(this.metrics[t]?global.console.warn(this.config.logPrefix,"Recording already started."):(this.metrics[t]={end:0,start:this.perf.now()},this.perf.mark(t,"start")))},t.prototype.end=function(t){if(this.checkMetricName(t)){if(this.metrics[t]){this.metrics[t].end=this.perf.now(),this.perf.mark(t,"end");var e=this.perf.measure(t,this.metrics);return this.config.logging&&this.log(t,e),delete this.metrics[t],this.sendTiming(t,e),e}global.console.warn(this.config.logPrefix,"Recording already stopped.")}},t.prototype.endPaint=function(t){var e=this;return new Promise(function(n,i){setTimeout(function(){var i=e.end(t);n(i)})})},t.prototype.log=function(t,e){if(t){var n=e.toFixed(2),i="%c "+this.config.logPrefix+" "+t+" "+n+" ms";global.console.log(i,"color: #ff6d00;font-size:12px;")}else global.console.warn(this.config.logPrefix,"Please provide a metric name")},t.prototype.checkMetricName=function(t){return!!t||(global.console.warn(this.config.logPrefix,"Please provide a metric name"),!1)},t.prototype.firstContentfulPaintCb=function(t){this.config.firstContentfulPaint&&this.logFCP(t.startTime),Performance.supported()&&Performance.supportedPerformanceObserver()&&Performance.supportedLongTask()&&this.config.timeToInteractive&&this.perf.timeToInteractive(t.startTime,this.timeToInteractiveCb.bind(this))},t.prototype.timeToInteractiveCb=function(t){this.timeToInteractiveDuration=t,this.timeToInteractiveDuration&&this.log("Time to interactive",this.timeToInteractiveDuration),this.config.timeToInteractiveCb&&this.config.timeToInteractiveCb(this.timeToInteractiveDuration),this.sendTiming("timeToInteractive",this.timeToInteractiveDuration)},t.prototype.logFCP=function(t){this.firstContentfulPaintDuration=t,this.log("First Contentful Paint",this.firstContentfulPaintDuration),this.sendTiming("firstContentfulPaint",this.firstContentfulPaintDuration)},t.prototype.sendTiming=function(t,e){if(this.config.googleAnalytics.enable)if(window.ga){var n=Math.round(e);window.ga("send","timing",t,this.config.googleAnalytics.timingVar,n)}else global.console.warn(this.config.logPrefix,"Google Analytics has not been loaded")},t}();export default Perfume;
//# sourceMappingURL=perfume.es5.js.map
